<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduManager Pro - Système de Gestion</title>
    <!-- Tailwind CSS pour le style -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons pour les icônes -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
        }

        @media print {
            .no-print { display: none !important; }
            .print-only { display: block !important; }
            body { background: white; }
            .print-content { 
                position: absolute; 
                left: 0; 
                top: 0; 
                width: 100%; 
                visibility: visible !important; 
            }
        }

        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .modal-backdrop {
            background: rgba(0, 0, 0, 0.6);
            display: none;
            position: fixed;
            inset: 0;
            z-index: 50;
            align-items: center;
            justify-content: center;
        }
        .modal-backdrop.active { display: flex; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">

    <div class="flex flex-col md:flex-row min-h-screen">
        <!-- Sidebar Navigation -->
        <aside class="w-full md:w-72 bg-white border-r border-gray-200 p-6 space-y-2 shrink-0 no-print">
            <div class="flex items-center space-x-2 mb-8 px-2 text-blue-700">
                <i data-lucide="book-open" class="w-8 h-8"></i>
                <h1 class="text-xl font-bold tracking-tight uppercase text-blue-900">EduManager Pro</h1>
            </div>
            <nav class="space-y-1" id="main-nav">
                <button onclick="switchTab('dashboard')" class="nav-btn active flex items-center space-x-2 px-4 py-3 rounded-lg w-full transition-colors bg-blue-600 text-white shadow-md" data-tab="dashboard">
                    <i data-lucide="layout-dashboard" class="w-5 h-5"></i><span>Tableau de bord</span>
                </button>
                <button onclick="switchTab('register')" class="nav-btn flex items-center space-x-2 px-4 py-3 rounded-lg w-full transition-colors text-gray-600 hover:bg-blue-50" data-tab="register">
                    <i data-lucide="user-plus" class="w-5 h-5"></i><span>Inscription</span>
                </button>
                <button onclick="switchTab('participants')" class="nav-btn flex items-center space-x-2 px-4 py-3 rounded-lg w-full transition-colors text-gray-600 hover:bg-blue-50" data-tab="participants">
                    <i data-lucide="users" class="w-5 h-5"></i><span>Participants</span>
                </button>
                <button onclick="switchTab('trainers')" class="nav-btn flex items-center space-x-2 px-4 py-3 rounded-lg w-full transition-colors text-gray-600 hover:bg-blue-50" data-tab="trainers">
                    <i data-lucide="calendar" class="w-5 h-5"></i><span>Gestion Formateurs</span>
                </button>
            </nav>
        </aside>

        <!-- Main Content Area -->
        <main class="flex-1 p-4 md:p-8 overflow-y-auto">
            
            <!-- Dashboard Tab -->
            <section id="tab-dashboard" class="tab-content active space-y-8 animate-in fade-in duration-500">
                <div class="flex justify-between items-end">
                    <div>
                        <h2 class="text-3xl font-black text-gray-800">Statistiques Globales</h2>
                        <p class="text-gray-500 text-sm">Analyse de performance en temps réel</p>
                    </div>
                    <div class="text-right hidden md:block">
                        <p class="text-[10px] font-black text-gray-400 uppercase">Dernière mise à jour</p>
                        <p id="last-update" class="text-xs font-bold text-blue-600"></p>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 flex items-center justify-between">
                        <div><p class="text-[10px] font-black text-gray-400 uppercase tracking-widest">Apprenants</p><p id="stat-total-participants" class="text-3xl font-black">0</p></div>
                        <div class="bg-blue-50 p-3 rounded-xl text-blue-600"><i data-lucide="users" class="w-6 h-6"></i></div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 flex items-center justify-between">
                        <div><p class="text-[10px] font-black text-gray-400 uppercase tracking-widest">Recettes Total</p><p id="stat-revenue" class="text-3xl font-black text-green-600">0$</p></div>
                        <div class="bg-green-50 p-3 rounded-xl text-green-600"><i data-lucide="trending-up" class="w-6 h-6"></i></div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 flex items-center justify-between">
                        <div><p class="text-[10px] font-black text-gray-400 uppercase tracking-widest">Solo (20$)</p><p id="stat-private" class="text-3xl font-black text-purple-600">0</p></div>
                        <div class="bg-purple-50 p-3 rounded-xl text-purple-600"><i data-lucide="star" class="w-6 h-6"></i></div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 flex items-center justify-between">
                        <div><p class="text-[10px] font-black text-gray-400 uppercase tracking-widest">Formateurs</p><p id="stat-trainers" class="text-3xl font-black text-orange-600">0</p></div>
                        <div class="bg-orange-50 p-3 rounded-xl text-orange-600"><i data-lucide="calendar" class="w-6 h-6"></i></div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="bg-white p-6 rounded-3xl border border-gray-100 shadow-sm flex flex-col justify-between">
                        <div class="flex items-center gap-2 mb-6">
                            <i data-lucide="pie-chart" class="w-5 h-5 text-blue-600"></i>
                            <h3 class="text-sm font-black text-gray-700 uppercase">Démographie</h3>
                        </div>
                        <div class="space-y-4">
                            <div class="relative h-4 bg-gray-100 rounded-full overflow-hidden flex" id="gender-bar">
                                <div id="female-bar" class="bg-pink-400 h-full transition-all duration-1000" style="width: 50%"></div>
                                <div id="male-bar" class="bg-blue-500 h-full transition-all duration-1000" style="width: 50%"></div>
                            </div>
                            <div class="flex justify-between text-xs font-bold">
                                <div class="flex items-center gap-2"><div class="w-2 h-2 rounded-full bg-pink-400"></div> Femmes <span id="female-count">0</span></div>
                                <div class="flex items-center gap-2"><div class="w-2 h-2 rounded-full bg-blue-500"></div> Hommes <span id="male-count">0</span></div>
                            </div>
                        </div>
                    </div>

                    <div class="lg:col-span-2 bg-white p-6 rounded-3xl border border-gray-100 shadow-sm">
                        <div class="flex items-center justify-between mb-6">
                            <div class="flex items-center gap-2">
                                <i data-lucide="bar-chart-3" class="w-5 h-5 text-blue-600"></i>
                                <h3 class="text-sm font-black text-gray-700 uppercase">Top Formations</h3>
                            </div>
                        </div>
                        <div id="top-courses-list" class="space-y-5">
                            <!-- Dynamically populated -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Registration Tab -->
            <section id="tab-register" class="tab-content max-w-4xl mx-auto space-y-6">
                <div class="flex items-center justify-between">
                    <h2 class="text-2xl font-bold text-gray-800">Fiche d'Inscription Candidat</h2>
                    <div class="flex gap-2">
                        <span class="bg-blue-50 px-3 py-1.5 rounded-lg text-blue-700 font-bold text-xs border border-blue-100">Groupe : 2$</span>
                        <span class="bg-purple-50 px-3 py-1.5 rounded-lg text-purple-700 font-bold text-xs border border-purple-100">Particulier : 20$</span>
                    </div>
                </div>

                <form id="registration-form" class="bg-white p-8 rounded-2xl shadow-xl border border-gray-100 space-y-10">
                    <!-- Infos Perso -->
                    <div class="space-y-6">
                        <div class="flex items-center gap-2 pb-2 border-b">
                            <i data-lucide="user" class="text-blue-600"></i>
                            <h3 class="font-bold text-gray-700 uppercase tracking-wide text-sm">1. Informations Personnelles</h3>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                            <div class="space-y-1">
                                <label class="text-[10px] font-bold text-gray-400 uppercase">Nom</label>
                                <input name="lastName" required placeholder="Nom de famille" class="w-full border p-3 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none bg-gray-50/50">
                            </div>
                            <div class="space-y-1">
                                <label class="text-[10px] font-bold text-gray-400 uppercase">Prénom</label>
                                <input name="firstName" required placeholder="Prénom" class="w-full border p-3 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none bg-gray-50/50">
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                            <div class="space-y-1">
                                <label class="text-[10px] font-bold text-gray-400 uppercase">Date de naissance</label>
                                <input name="birthDate" type="date" required class="w-full border p-3 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none bg-gray-50/50">
                            </div>
                            <div class="space-y-1">
                                <label class="text-[10px] font-bold text-gray-400 uppercase">Sexe</label>
                                <select name="gender" required class="w-full border p-3 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none bg-gray-50/50">
                                    <option value="M">Masculin</option>
                                    <option value="F">Féminin</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Choix Formation -->
                    <div class="space-y-6 pt-4 border-t">
                        <div class="flex items-center gap-2 pb-2 border-b">
                            <i data-lucide="book-open" class="text-blue-600"></i>
                            <h3 class="font-bold text-gray-700 uppercase tracking-wide text-sm">2. Formations (Max 2)</h3>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="courses-grid">
                            <!-- Populated in JS -->
                        </div>
                    </div>

                    <!-- Type de cours -->
                    <div class="space-y-6 pt-4 border-t">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                             <div class="space-y-1">
                                <label class="text-[10px] font-bold text-gray-400 uppercase">Formule</label>
                                <select name="courseType" id="courseType" onchange="updatePrice()" class="w-full border p-3 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none bg-gray-50/50">
                                    <option value="En groupe">En groupe (2$)</option>
                                    <option value="Cours particulier">Cours particulier (20$)</option>
                                </select>
                            </div>
                            <div class="space-y-1">
                                <label class="text-[10px] font-bold text-gray-400 uppercase">Photo (Optionnel)</label>
                                <input type="file" id="photo-input" accept="image/*" class="text-xs">
                            </div>
                        </div>
                    </div>

                    <div class="flex items-center justify-between p-6 bg-blue-50 rounded-2xl border border-blue-100">
                        <div class="text-3xl font-black text-blue-700" id="total-price-display">0 $</div>
                        <button type="submit" class="bg-blue-700 text-white font-black px-8 py-4 rounded-xl shadow-xl flex items-center gap-3 uppercase tracking-wider hover:bg-blue-800 transition-all">
                            <i data-lucide="check-circle"></i> Confirmer
                        </button>
                    </div>
                </form>
            </section>

            <!-- Participants Tab -->
            <section id="tab-participants" class="tab-content space-y-6">
                <div class="flex justify-between items-center">
                    <h2 class="text-2xl font-bold text-gray-800">Registre des Apprenants</h2>
                    <div class="bg-white border px-4 py-2 rounded-lg flex items-center gap-2 shadow-sm">
                        <i data-lucide="search" class="w-4 h-4 text-gray-400"></i>
                        <input id="search-participants" placeholder="Filtrer..." class="text-sm outline-none">
                    </div>
                </div>
                
                <div class="bg-white rounded-2xl border border-gray-100 overflow-hidden shadow-sm overflow-x-auto">
                    <table class="w-full text-left min-w-[850px]">
                        <thead class="bg-gray-50 text-[10px] font-black uppercase tracking-widest text-gray-400 border-b">
                            <tr>
                                <th class="p-5">Apprenant</th>
                                <th class="p-5">Contacts & Formule</th>
                                <th class="p-5">Cours choisis</th>
                                <th class="p-5">Paiement</th>
                                <th class="p-5 text-center">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="participants-tbody" class="divide-y divide-gray-50">
                            <!-- Dynamically populated -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Trainers Tab -->
            <section id="tab-trainers" class="tab-content space-y-6">
                <div class="flex justify-between items-center">
                    <h2 class="text-2xl font-bold text-gray-800">Gestion des Formateurs</h2>
                    <button onclick="toggleModal('trainer-modal', true)" class="bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 font-bold text-sm shadow-md hover:bg-blue-700">
                        <i data-lucide="plus" class="w-4 h-4"></i> Nouveau Formateur
                    </button>
                </div>
                <div id="trainers-grid" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Dynamically populated -->
                </div>
            </section>

        </main>
    </div>

    <!-- Modal: Impression / Détails -->
    <div id="print-modal" class="modal-backdrop no-print">
        <div class="bg-white rounded-2xl max-w-2xl w-full mx-4 overflow-hidden shadow-2xl">
            <div class="flex items-center justify-between p-4 bg-gray-50 border-b">
                <h3 class="font-bold text-gray-700 flex items-center gap-2 uppercase tracking-tighter"><i data-lucide="file-text" class="w-4 h-4"></i> Fiche Apprenant</h3>
                <div class="flex gap-2">
                    <button onclick="window.print()" class="bg-blue-600 text-white px-3 py-1.5 rounded-lg text-xs font-bold flex items-center gap-2"><i data-lucide="printer" class="w-4 h-4"></i> Imprimer</button>
                    <button onclick="toggleModal('print-modal', false)" class="p-1.5 hover:bg-gray-200 rounded-lg text-gray-400"><i data-lucide="x" class="w-5 h-5"></i></button>
                </div>
            </div>
            <div id="print-area" class="p-8 space-y-8 bg-white text-gray-900 print-content">
                <!-- Injected via JS -->
            </div>
        </div>
    </div>

    <!-- Modal: Nouveau Formateur -->
    <div id="trainer-modal" class="modal-backdrop no-print">
        <div class="bg-white rounded-3xl p-8 max-w-md w-full mx-4 shadow-2xl">
            <div class="flex items-center gap-2 mb-6 text-blue-700 border-b pb-4">
                <i data-lucide="user-plus" class="w-6 h-6"></i>
                <h3 class="text-xl font-black uppercase tracking-tight">Recrutement</h3>
            </div>
            <form id="trainer-form" class="space-y-4">
                <input name="name" required placeholder="Nom Complet" class="w-full border p-3.5 rounded-xl text-sm outline-none focus:ring-2 focus:ring-blue-600">
                <input name="domain" required placeholder="Domaine (ex: Anglais)" class="w-full border p-3.5 rounded-xl text-sm outline-none focus:ring-2 focus:ring-blue-600">
                <input name="availability" required placeholder="Disponibilités" class="w-full border p-3.5 rounded-xl text-sm outline-none focus:ring-2 focus:ring-blue-600">
                <div class="flex gap-3 pt-6">
                    <button type="button" onclick="toggleModal('trainer-modal', false)" class="flex-1 px-4 py-3.5 border rounded-xl font-bold text-xs uppercase hover:bg-gray-50">Annuler</button>
                    <button type="submit" class="flex-1 px-4 py-3.5 bg-blue-600 text-white rounded-xl font-bold text-xs uppercase shadow-lg hover:bg-blue-700">Enregistrer</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // --- DATA & CONFIG ---
        const courseCatalog = [
            { cat: 'Langues', items: ['Anglais Business', 'Français FLE', 'Espagnol', 'Alphabétisation'] },
            { cat: 'Métiers', items: ['Coiffure', 'Esthétique', 'Maquillage'] }
        ];

        let state = {
            participants: JSON.parse(localStorage.getItem('edu_participants')) || [],
            trainers: JSON.parse(localStorage.getItem('edu_trainers')) || [
                { id: 1, name: 'Jean Dupont', domain: 'Anglais Business', availability: 'Lundi, Mardi', status: 'Actif' }
            ],
            currentPhoto: null
        };

        // --- CORE FUNCTIONS ---
        function save() {
            localStorage.setItem('edu_participants', JSON.stringify(state.participants));
            localStorage.setItem('edu_trainers', JSON.stringify(state.trainers));
            renderDashboard();
            renderParticipants();
            renderTrainers();
        }

        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.getElementById('tab-' + tabId).classList.add('active');
            
            document.querySelectorAll('.nav-btn').forEach(b => {
                b.classList.remove('bg-blue-600', 'text-white', 'shadow-md');
                b.classList.add('text-gray-600');
                if(b.dataset.tab === tabId) {
                    b.classList.add('bg-blue-600', 'text-white', 'shadow-md');
                    b.classList.remove('text-gray-600');
                }
            });
        }

        function toggleModal(id, show) {
            document.getElementById(id).classList.toggle('active', show);
        }

        // --- RENDERERS ---
        function renderDashboard() {
            const rev = state.participants.reduce((a, c) => a + c.price, 0);
            const females = state.participants.filter(p => p.gender === 'F').length;
            const males = state.participants.filter(p => p.gender === 'M').length;
            const solo = state.participants.filter(p => p.type === 'Cours particulier').length;

            document.getElementById('stat-total-participants').innerText = state.participants.length;
            document.getElementById('stat-revenue').innerText = rev + '$';
            document.getElementById('stat-private').innerText = solo;
            document.getElementById('stat-trainers').innerText = state.trainers.length;
            document.getElementById('last-update').innerText = new Date().toLocaleTimeString();

            // Démographie
            const total = state.participants.length || 1;
            document.getElementById('female-bar').style.width = (females / total * 100) + '%';
            document.getElementById('male-bar').style.width = (males / total * 100) + '%';
            document.getElementById('female-count').innerText = females;
            document.getElementById('male-count').innerText = males;

            // Popularité
            const counts = {};
            state.participants.forEach(p => p.courses.forEach(c => counts[c] = (counts[c] || 0) + 1));
            const sorted = Object.entries(counts).sort((a,b) => b[1] - a[1]).slice(0,3);
            
            document.getElementById('top-courses-list').innerHTML = sorted.map(([name, count]) => `
                <div class="space-y-1">
                    <div class="flex justify-between text-xs font-bold uppercase">
                        <span>${name}</span>
                        <span>${count} inscrits</span>
                    </div>
                    <div class="h-2 bg-gray-100 rounded-full overflow-hidden">
                        <div class="bg-blue-600 h-full" style="width: ${(count/total*100)}%"></div>
                    </div>
                </div>
            `).join('') || '<p class="text-center py-10 text-gray-400">Aucune donnée</p>';
        }

        function renderParticipants() {
            const query = document.getElementById('search-participants').value.toLowerCase();
            const filtered = state.participants.filter(p => 
                p.lastName.toLowerCase().includes(query) || p.firstName.toLowerCase().includes(query)
            );

            document.getElementById('participants-tbody').innerHTML = filtered.map(p => `
                <tr class="hover:bg-blue-50/30 transition-colors">
                    <td class="p-5">
                        <div class="flex items-center gap-4">
                            <div class="w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center text-blue-700 font-bold overflow-hidden">
                                ${p.photo ? `<img src="${p.photo}" class="w-full h-full object-cover">` : p.firstName[0]}
                            </div>
                            <div>
                                <div class="font-bold text-gray-900 text-sm uppercase">${p.lastName} ${p.firstName}</div>
                                <div class="text-[10px] text-gray-400">ID: #${p.id}</div>
                            </div>
                        </div>
                    </td>
                    <td class="p-5">
                        <div class="text-xs text-gray-600">${p.phone}</div>
                        <span class="text-[9px] font-black uppercase px-2 py-0.5 rounded ${p.type === 'Cours particulier' ? 'bg-purple-100 text-purple-700' : 'bg-blue-100 text-blue-700'}">${p.type}</span>
                    </td>
                    <td class="p-5">
                        <div class="flex flex-wrap gap-1">
                            ${p.courses.map(c => `<span class="px-2 py-0.5 bg-blue-600 text-white text-[9px] font-bold rounded">${c}</span>`).join('')}
                        </div>
                    </td>
                    <td class="p-5 text-sm font-black text-green-600">${p.price}$</td>
                    <td class="p-5">
                        <div class="flex justify-center gap-2">
                            <button onclick="printParticipant(${p.id})" class="p-2 text-blue-600 hover:bg-blue-50 rounded-lg"><i data-lucide="printer" class="w-4 h-4"></i></button>
                            <button onclick="deleteParticipant(${p.id})" class="p-2 text-red-400 hover:bg-red-50 rounded-lg"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                        </div>
                    </td>
                </tr>
            `).join('');
            lucide.createIcons();
        }

        function renderTrainers() {
            document.getElementById('trainers-grid').innerHTML = state.trainers.map(t => `
                <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm flex items-center gap-6">
                    <div class="w-16 h-16 bg-blue-600 rounded-2xl flex items-center justify-center text-white text-xl font-black">${t.name[0]}</div>
                    <div class="flex-1">
                        <h4 class="font-bold">${t.name}</h4>
                        <p class="text-xs text-blue-600 font-bold uppercase">${t.domain}</p>
                        <div class="text-[10px] text-gray-400 mt-2 italic">Dispo: ${t.availability}</div>
                    </div>
                    <span class="px-2 py-0.5 rounded-full text-[9px] font-black uppercase bg-green-100 text-green-700">${t.status}</span>
                </div>
            `).join('');
            lucide.createIcons();
        }

        // --- ACTIONS ---
        function updatePrice() {
            const type = document.getElementById('courseType').value;
            const count = document.querySelectorAll('input[name="course"]:checked').length;
            const unit = type === 'Cours particulier' ? 20 : 2;
            document.getElementById('total-price-display').innerText = (count * unit) + ' $';
        }

        function deleteParticipant(id) {
            state.participants = state.participants.filter(p => p.id !== id);
            save();
        }

        function printParticipant(id) {
            const p = state.participants.find(x => x.id === id);
            if(!p) return;

            document.getElementById('print-area').innerHTML = `
                <div class="flex justify-between items-start border-b-2 border-blue-600 pb-6">
                    <div class="space-y-1">
                        <h1 class="text-3xl font-black text-blue-800 uppercase">EduManager Pro</h1>
                        <p class="text-xs font-bold text-gray-500 uppercase tracking-widest">Formation Continue</p>
                        <p class="text-[10px] text-gray-400 mt-2 italic">Dossier: #${p.id}</p>
                    </div>
                    <div class="w-28 h-32 border-2 border-blue-100 rounded-xl bg-gray-50 flex items-center justify-center overflow-hidden">
                        ${p.photo ? `<img src="${p.photo}" class="w-full h-full object-cover">` : '<i data-lucide="camera" class="w-8 h-8 text-gray-300"></i>'}
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-10">
                    <div class="space-y-6">
                        <h4 class="text-[10px] font-black text-blue-600 uppercase border-b pb-1">Identité</h4>
                        <div class="text-xs space-y-2">
                            <p><strong>Nom:</strong> ${p.lastName.toUpperCase()}</p>
                            <p><strong>Prénom:</strong> ${p.firstName}</p>
                            <p><strong>Contact:</strong> ${p.phone}</p>
                        </div>
                    </div>
                    <div class="space-y-6">
                        <h4 class="text-[10px] font-black text-blue-600 uppercase border-b pb-1">Formation</h4>
                        <div class="space-y-2">
                            ${p.courses.map(c => `<div class="text-xs font-bold p-2 bg-gray-50 border-l-4 border-blue-600">${c}</div>`).join('')}
                            <p class="text-[10px] font-bold text-blue-700 uppercase mt-4">Paiement : ${p.price}$ (${p.type})</p>
                        </div>
                    </div>
                </div>
                <div class="mt-20 flex justify-between px-10">
                    <div class="text-center text-[10px] font-bold text-gray-400 uppercase">Signature Candidat</div>
                    <div class="text-center text-[10px] font-bold text-gray-400 uppercase">Cachet Centre</div>
                </div>
            `;
            lucide.createIcons();
            toggleModal('print-modal', true);
        }

        // --- EVENT LISTENERS ---
        document.getElementById('photo-input').addEventListener('change', (e) => {
            const reader = new FileReader();
            reader.onload = () => state.currentPhoto = reader.result;
            reader.readAsDataURL(e.target.files[0]);
        });

        document.getElementById('registration-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const courses = Array.from(document.querySelectorAll('input[name="course"]:checked')).map(i => i.value);
            
            if(courses.length === 0) return alert('Sélectionnez au moins une formation');

            const type = formData.get('courseType');
            const price = courses.length * (type === 'Cours particulier' ? 20 : 2);

            state.participants.push({
                id: Date.now(),
                firstName: formData.get('firstName'),
                lastName: formData.get('lastName'),
                gender: formData.get('gender'),
                phone: formData.get('phone') || 'Non renseigné',
                email: formData.get('email') || 'N/A',
                courses: courses,
                type: type,
                price: price,
                photo: state.currentPhoto,
                date: new Date().toLocaleDateString()
            });

            e.target.reset();
            state.currentPhoto = null;
            updatePrice();
            save();
            switchTab('participants');
        });

        document.getElementById('trainer-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            state.trainers.push({
                id: Date.now(),
                name: formData.get('name'),
                domain: formData.get('domain'),
                availability: formData.get('availability'),
                status: 'Actif'
            });
            e.target.reset();
            save();
            toggleModal('trainer-modal', false);
        });

        document.getElementById('search-participants').addEventListener('input', renderParticipants);

        // --- INIT ---
        window.onload = () => {
            // Remplir le catalogue de cours
            document.getElementById('courses-grid').innerHTML = courseCatalog.map(cat => `
                <div class="space-y-2">
                    <h4 class="text-[10px] font-black text-blue-800 uppercase bg-blue-50 p-2 rounded border-l-2 border-blue-600">${cat.cat}</h4>
                    ${cat.items.map(item => `
                        <label class="flex items-center gap-3 p-3 rounded-xl border border-gray-100 hover:bg-gray-50 cursor-pointer text-xs">
                            <input type="checkbox" name="course" value="${item}" onchange="updatePrice()">
                            <span>${item}</span>
                        </label>
                    `).join('')}
                </div>
            `).join('');

            lucide.createIcons();
            save();
        };
    </script>
</body>
</html>